/*
  ==============================================================================

   This file is part of the JUCE library.
   Copyright (c) 2020 - Raw Material Software Limited

   JUCE is an open source library subject to commercial or open-source
   licensing.

   By using JUCE, you agree to the terms of both the JUCE 6 End-User License
   Agreement and JUCE Privacy Policy (both effective as of the 16th June 2020).

   End User License Agreement: www.juce.com/juce-6-licence
   Privacy Policy: www.juce.com/juce-privacy-policy

   Or: You may also use this code under the terms of the GPL v3 (see
   www.gnu.org/licenses).

   JUCE IS PROVIDED "AS IS" WITHOUT ANY WARRANTY, AND ALL WARRANTIES, WHETHER
   EXPRESSED OR IMPLIED, INCLUDING MERCHANTABILITY AND FITNESS FOR PURPOSE, ARE
   DISCLAIMED.

  ==============================================================================
*/

namespace juce
{
// This byte-code is generated from native/java/com/rmls/juce/ComponentPeerView.java with min sdk version 23
// See juce_core/native/java/README.txt on how to generate this byte-code.
//================== test.dex.gz ==================
static const uint8 javaComponentPeerView[] =
{ 31,139,8,8,129,55,82,95,0,11,74,97,118,97,68,101,120,66,121,116,101,67,111,100,101,46,100,101,120,0,165,154,9,124,92,85,189,199,255,231,222,89,146,201,36,153,76,210,172,147,118,154,164,109,246,76,210,150,182,36,133,166,89,32,233,164,13,217,104,147,98,
123,147,220,36,211,78,238,157,206,76,150,34,66,41,213,162,240,180,104,17,120,160,32,219,227,241,80,209,87,125,130,117,5,43,15,23,44,15,89,30,85,65,121,168,60,192,178,185,96,31,245,119,206,61,147,76,55,81,95,242,249,206,255,127,254,103,185,103,249,159,
255,57,51,159,59,170,207,186,2,203,87,210,53,71,62,117,176,117,251,139,183,214,126,115,239,149,43,238,215,250,95,171,185,49,239,189,219,93,142,235,107,136,34,68,52,59,176,194,75,242,239,112,53,17,99,150,125,37,136,219,136,86,65,94,108,39,42,132,60,230,
36,10,67,62,144,66,4,19,185,221,68,47,248,145,134,28,40,32,218,12,182,129,113,48,3,174,1,55,130,207,131,67,224,63,192,215,193,35,224,8,120,28,252,8,28,5,175,128,215,192,27,224,29,240,46,240,226,161,23,131,17,112,37,184,5,60,4,158,3,182,34,162,133,96,
21,8,130,97,240,65,112,19,248,46,120,6,188,1,42,124,68,157,224,114,240,57,240,35,112,2,180,22,19,93,5,238,4,95,3,207,129,140,133,68,13,160,7,76,129,79,128,59,193,17,240,42,96,139,136,202,192,106,112,41,216,9,174,2,95,0,143,131,99,224,21,240,22,248,19,
72,193,220,228,130,2,176,12,172,4,107,192,58,208,10,130,160,7,108,6,151,1,13,140,129,157,32,2,166,193,229,96,47,248,48,248,24,56,0,110,4,183,128,207,130,59,193,189,224,97,240,4,120,30,252,26,188,5,78,130,180,197,68,249,192,15,106,192,42,208,3,250,193,
4,136,128,89,176,7,124,20,28,0,159,1,247,131,135,193,139,224,56,248,19,160,18,34,7,72,5,30,176,16,84,128,117,96,19,216,2,116,16,3,87,130,79,129,207,130,47,130,111,128,35,224,9,112,12,188,14,222,3,217,165,104,22,52,128,110,48,0,182,130,109,32,2,246,130,
131,224,46,240,32,56,2,158,1,191,1,127,0,182,50,172,27,88,6,234,193,42,112,62,104,7,27,192,86,176,19,92,1,174,7,55,129,123,192,231,193,67,224,17,240,99,240,12,56,14,78,2,199,18,162,5,160,8,148,130,0,88,13,26,65,51,232,4,221,96,0,132,192,149,224,0,184,
11,124,27,252,23,120,25,28,7,169,75,137,178,128,31,4,64,35,232,4,189,224,50,16,6,151,131,189,224,58,112,35,184,13,220,7,190,8,190,12,158,6,191,0,191,5,206,101,24,47,200,6,165,160,30,116,130,65,48,1,246,130,91,192,87,193,35,224,73,240,115,240,58,56,1,
210,202,49,46,80,9,90,65,39,232,1,131,96,59,208,193,78,48,5,102,193,85,224,90,240,113,112,59,184,31,28,6,143,129,31,128,31,131,39,193,211,0,97,129,210,64,58,200,1,11,64,46,200,3,249,0,91,90,196,17,108,75,194,22,36,108,57,194,182,34,108,21,130,171,146,
116,49,194,178,18,150,129,48,125,132,33,19,186,77,104,158,42,64,37,168,2,8,85,132,16,70,181,160,14,4,64,61,104,0,203,193,10,25,195,206,35,43,134,173,6,107,192,249,160,17,52,129,181,224,2,112,33,104,7,151,130,203,192,7,192,54,176,157,172,49,37,254,82,
165,180,229,91,227,100,50,237,150,58,183,243,177,43,210,158,33,117,55,236,30,72,135,180,123,101,187,57,210,158,33,237,30,153,151,208,23,36,149,231,243,231,203,183,116,62,119,101,178,110,153,44,147,37,231,137,247,33,91,206,85,181,44,207,245,21,178,124,
149,44,159,45,231,174,41,223,26,123,157,180,119,72,157,183,211,41,245,86,232,27,164,222,13,61,40,245,205,208,187,164,62,1,125,163,212,227,208,55,73,125,15,244,110,169,95,11,189,71,234,7,146,236,55,39,233,119,64,239,147,250,125,73,246,67,73,250,225,36,
253,209,164,54,127,152,100,127,10,122,175,212,143,37,217,223,206,155,215,249,28,94,34,245,151,146,218,121,53,169,60,159,183,254,68,93,232,3,82,63,145,84,198,93,48,175,231,20,88,126,20,144,243,185,89,234,62,216,183,72,189,12,250,160,212,3,208,183,74,125,
53,244,33,169,175,75,178,95,156,100,239,46,224,254,198,104,146,44,249,6,241,253,85,74,19,82,222,33,36,163,187,164,188,71,202,123,165,252,23,41,255,85,150,255,50,241,61,25,160,47,9,89,68,191,35,190,63,125,244,186,148,127,16,178,144,222,21,126,167,208,
231,132,44,162,7,133,12,208,19,66,166,209,147,196,247,113,21,169,82,218,132,12,144,83,166,93,66,50,186,72,166,47,22,254,90,70,45,196,239,18,217,98,159,112,249,168,144,197,244,52,241,253,226,160,43,133,244,208,117,196,247,159,85,46,21,59,255,121,72,23,
34,6,79,167,73,123,26,158,118,76,204,139,149,206,196,231,135,132,204,162,171,100,250,122,226,251,192,178,123,208,203,189,50,253,17,33,85,218,79,214,62,185,86,202,143,10,201,232,6,41,63,73,124,79,41,116,141,144,37,116,128,248,94,90,40,158,151,141,232,
243,159,66,214,211,227,66,46,160,31,17,223,199,75,105,135,148,207,17,143,137,75,68,249,2,68,170,219,133,44,165,95,8,185,146,126,43,214,97,153,200,47,68,11,143,137,249,175,16,233,34,216,53,41,135,133,116,211,136,144,217,244,138,148,255,43,214,99,145,40,
239,195,76,142,10,89,78,186,144,217,226,254,198,229,46,185,126,211,66,22,210,21,66,58,232,106,185,206,215,8,89,75,251,132,76,165,143,9,233,162,127,146,249,31,23,50,133,62,33,164,53,15,62,140,236,160,148,55,74,249,105,33,243,233,38,41,111,150,246,91,132,
204,163,127,150,242,86,41,111,19,178,128,62,35,100,29,125,94,202,47,8,233,163,111,72,255,251,166,148,223,146,242,219,50,255,59,50,253,93,41,31,145,254,249,61,33,253,116,68,200,37,244,125,33,173,245,242,201,245,226,233,31,8,89,77,63,20,210,90,63,31,78,
147,31,11,89,69,63,147,242,231,66,150,209,139,66,230,208,175,132,172,164,151,100,250,127,100,185,151,165,252,181,204,255,141,28,255,31,137,159,127,11,233,62,226,103,160,229,175,11,165,255,47,146,233,50,120,216,135,133,60,143,30,16,251,37,131,126,79,60,
158,91,249,21,56,109,246,16,137,93,23,21,82,161,175,16,63,27,43,233,171,196,227,123,38,253,27,89,103,46,145,117,14,240,248,199,207,161,71,33,31,144,135,65,145,244,245,10,89,142,231,63,133,252,111,201,124,126,222,100,145,117,102,156,144,245,95,130,252,
181,204,231,103,56,63,255,236,178,126,171,148,55,85,91,114,145,172,159,104,63,81,238,30,228,223,81,101,157,145,97,200,24,224,241,227,67,144,251,192,199,171,172,118,111,18,118,69,232,207,149,91,231,240,144,55,141,34,158,49,216,188,180,213,227,18,103,104,
10,82,188,254,47,203,173,120,153,237,200,161,18,197,141,114,46,212,238,139,165,81,223,114,55,25,158,21,40,229,102,94,90,195,154,230,173,254,213,216,133,243,101,26,80,198,165,246,224,120,237,89,194,232,75,125,55,144,106,91,185,189,144,250,99,46,90,173,
230,146,87,221,10,45,81,190,47,158,70,187,60,203,16,79,220,182,93,30,30,253,210,108,187,2,213,212,98,231,229,215,168,78,90,181,221,78,222,108,94,39,3,207,202,67,228,50,60,185,232,239,233,207,40,135,163,217,196,104,113,215,171,224,49,139,143,213,45,199,
90,130,181,140,248,75,176,90,67,158,12,26,202,78,23,227,102,226,31,241,188,130,68,220,141,120,248,109,41,99,206,190,104,206,94,33,236,138,188,185,44,171,176,230,187,207,147,46,214,71,133,157,63,183,174,194,186,211,244,249,211,209,75,126,139,194,8,23,
243,126,251,240,228,140,185,114,231,157,179,92,177,40,151,129,149,230,35,89,139,114,220,31,189,14,239,130,136,63,31,103,79,137,141,175,94,10,122,53,116,16,81,20,95,230,34,129,50,58,152,58,116,208,67,62,155,29,45,140,210,221,228,178,173,182,93,70,139,
92,60,173,32,82,12,222,150,9,109,43,133,104,235,173,89,208,250,113,162,26,254,1,241,121,41,34,74,9,60,35,226,225,222,149,109,203,161,210,230,122,90,202,248,249,110,248,249,9,210,199,159,100,119,97,254,156,196,91,76,197,61,195,171,26,158,113,212,114,219,
10,237,47,144,119,105,233,216,114,242,58,135,83,10,168,43,197,225,244,230,249,82,210,132,102,4,70,168,207,225,86,87,171,57,228,85,188,101,165,173,43,200,107,223,229,209,49,58,183,163,203,97,179,123,23,120,133,52,2,59,233,83,54,204,129,7,254,131,118,23,
217,172,222,31,164,242,207,165,219,202,223,6,111,130,227,224,191,193,179,88,114,113,87,158,255,219,115,33,253,93,233,211,255,172,124,126,119,203,69,220,227,113,159,159,91,138,186,116,31,91,178,151,213,236,97,74,229,181,172,252,35,204,90,111,254,119,151,
244,131,94,127,166,136,3,220,255,120,250,254,132,223,4,46,160,197,42,95,77,107,127,253,187,244,203,222,117,153,148,171,136,123,183,178,6,57,25,194,18,9,52,146,141,149,191,59,223,254,215,43,172,61,207,191,11,12,226,25,25,242,25,252,239,59,21,214,254,247,
122,50,231,252,242,7,178,63,253,158,44,241,28,69,250,241,209,10,18,247,8,195,115,30,223,57,184,207,219,68,61,47,149,191,167,202,246,158,169,176,98,134,117,247,182,110,226,191,72,178,57,96,227,37,95,126,159,49,172,145,99,72,148,255,221,251,148,63,127,
110,204,86,63,254,120,150,126,240,47,47,167,219,156,73,54,155,124,86,70,165,117,175,247,50,30,185,135,2,10,89,82,165,45,245,136,34,199,183,4,156,180,37,224,144,214,84,248,15,34,178,103,75,128,123,210,1,68,193,45,129,20,236,133,92,244,106,33,249,89,150,
24,3,159,255,226,74,43,14,159,125,12,125,235,189,20,233,89,79,182,75,202,113,56,57,97,231,107,191,228,156,117,150,183,157,60,41,198,190,46,64,54,141,215,73,133,157,63,167,161,210,186,171,122,61,189,195,168,133,102,234,153,98,91,195,176,90,152,195,106,
39,255,62,200,115,12,196,157,20,114,177,200,37,77,180,52,86,254,150,137,203,240,116,138,139,202,95,55,60,53,232,117,57,191,212,40,86,63,18,223,31,249,247,153,116,137,11,57,252,121,193,74,235,187,160,151,205,61,79,193,243,80,51,147,173,113,166,226,57,
105,232,155,75,241,150,54,52,56,201,92,87,72,211,55,187,88,249,155,134,199,205,247,190,178,90,121,237,100,66,55,252,19,120,134,75,244,47,210,141,126,169,222,172,242,159,89,243,193,159,53,86,105,125,47,59,117,62,172,145,113,27,31,147,3,207,138,244,172,
197,76,122,61,229,239,88,247,88,254,23,75,90,235,84,180,198,219,187,90,206,175,185,185,136,250,166,147,91,93,141,103,90,190,245,1,248,22,175,195,119,8,255,222,248,73,212,241,161,161,222,163,40,173,242,217,101,170,152,93,150,201,12,15,143,187,174,84,195,
195,247,89,154,243,167,55,156,164,42,246,123,49,59,229,111,244,62,137,221,194,12,127,22,206,108,151,205,240,120,121,89,187,225,201,230,210,225,60,58,157,114,33,63,81,179,202,143,189,127,201,102,171,228,247,223,191,228,58,148,52,60,252,68,112,165,121,
179,86,21,85,146,119,113,169,175,1,113,113,57,238,87,222,194,149,15,47,38,222,10,111,227,11,188,13,127,14,151,204,107,111,181,187,237,123,251,143,44,48,252,11,44,75,110,171,195,237,216,59,118,36,55,209,238,179,46,172,228,11,232,199,53,57,140,78,18,125,
229,134,23,93,44,101,141,43,159,254,214,17,84,208,216,201,228,254,252,35,61,225,45,149,63,255,247,247,224,66,217,131,37,255,239,30,92,40,122,128,101,102,78,225,107,220,183,120,124,168,147,146,199,149,67,220,7,133,239,41,226,92,78,169,178,126,3,64,31,
113,10,58,225,253,133,234,47,201,155,83,218,138,83,208,62,236,192,41,40,78,180,17,106,176,185,217,26,180,156,129,125,87,254,30,56,225,245,150,150,224,12,84,249,25,152,130,115,174,203,166,168,252,236,219,165,148,191,158,174,148,191,10,94,1,191,225,254,
158,133,190,241,59,166,155,71,34,165,50,183,60,95,93,90,190,164,186,166,50,41,14,54,84,205,239,13,85,90,207,175,178,238,122,171,21,39,246,151,225,31,68,137,12,242,174,43,255,51,31,159,21,43,91,170,172,223,123,12,79,189,184,213,21,42,247,163,164,13,247,
43,55,238,157,5,180,26,145,195,240,132,176,67,93,108,45,203,198,108,27,129,197,20,192,136,87,137,242,70,192,79,30,91,95,189,7,247,183,37,162,253,68,142,87,49,2,139,200,163,88,121,75,249,252,190,57,127,215,218,92,149,184,83,17,37,238,84,220,126,89,149,
117,206,153,30,158,222,229,217,134,207,66,90,15,109,135,88,137,117,115,90,179,212,230,239,105,227,115,109,142,9,59,255,93,61,249,239,107,167,165,31,59,45,205,219,200,33,235,60,205,66,75,76,218,56,62,41,83,164,204,147,178,72,150,175,192,119,28,158,174,
146,233,42,204,170,141,18,227,181,250,167,72,191,74,156,211,138,244,171,196,216,45,221,41,126,27,83,4,129,36,59,151,233,214,239,100,242,217,14,153,231,64,57,69,218,156,82,166,74,233,150,117,51,208,35,203,151,228,125,65,214,241,73,95,225,223,253,120,126,
64,246,49,144,212,111,78,189,148,13,178,62,147,119,25,46,51,231,108,153,242,89,86,61,207,220,179,172,52,191,61,219,235,107,87,212,6,200,209,20,50,66,241,11,40,163,185,187,59,216,209,210,220,215,177,105,227,182,142,86,114,173,239,239,8,182,110,235,219,
210,221,70,158,245,83,161,240,104,139,105,140,133,198,107,119,104,211,26,229,182,152,147,17,211,208,141,120,183,174,71,7,66,250,140,101,183,183,182,173,239,191,136,88,59,41,237,29,228,104,15,54,15,108,234,33,214,65,74,71,7,177,78,82,58,131,148,183,65,
223,61,108,106,209,209,214,80,108,50,20,139,5,67,177,184,110,232,81,98,65,82,130,40,26,12,146,26,196,71,110,80,51,70,163,102,104,180,78,139,68,234,154,71,226,161,233,80,124,119,35,173,56,213,30,137,132,67,35,90,60,100,26,101,137,50,193,208,152,62,178,
123,36,172,183,104,225,240,176,54,178,51,214,72,5,231,170,149,156,53,98,26,232,75,188,174,133,203,217,120,114,214,120,84,139,76,132,70,98,117,45,154,49,173,161,193,133,103,201,50,195,102,180,61,20,142,235,209,115,231,119,105,241,104,104,182,145,42,254,
106,254,41,77,229,159,89,180,91,11,25,232,95,222,153,57,61,250,8,50,178,231,50,204,88,221,250,41,99,52,172,55,82,78,178,177,99,125,200,24,229,173,207,183,49,141,133,172,195,242,180,77,235,188,241,194,83,51,186,76,62,93,50,175,226,212,60,238,2,101,155,
140,118,115,100,42,214,50,161,25,227,122,98,89,147,187,50,87,52,121,72,115,198,139,162,230,84,164,145,206,59,51,167,47,170,235,155,134,99,122,116,90,143,226,41,23,133,205,97,45,28,212,118,155,83,241,249,199,44,250,235,245,26,169,246,212,2,33,35,50,21,
159,212,227,19,230,104,221,122,45,166,119,240,52,22,222,192,252,9,183,88,114,238,242,109,163,161,184,25,237,48,198,204,70,170,60,119,177,51,154,172,121,159,178,93,66,239,210,12,109,156,247,184,61,56,98,78,214,69,39,99,225,186,29,83,35,122,221,25,187,
174,236,28,123,169,236,212,145,175,249,71,219,105,164,197,239,87,149,123,213,169,69,58,17,9,248,114,112,107,124,198,220,102,152,113,61,86,23,213,39,33,235,250,204,169,145,9,236,190,70,90,126,90,1,76,104,68,31,53,183,205,132,162,122,88,143,197,182,201,
26,73,193,167,145,74,130,163,90,120,58,180,179,78,51,80,75,236,223,186,54,99,36,108,198,66,198,120,75,88,139,137,141,121,102,153,14,172,65,84,230,47,62,75,126,151,62,57,44,11,232,49,238,157,60,156,213,133,225,200,117,112,231,104,175,190,107,74,55,70,
176,133,178,146,115,172,246,74,146,76,29,225,176,62,174,133,155,71,70,48,130,182,217,17,61,98,45,124,217,89,202,68,199,167,38,49,145,73,165,178,147,75,33,2,141,91,43,48,111,220,104,246,98,250,44,47,73,170,231,77,42,178,105,120,135,8,0,197,73,182,94,125,
100,42,138,184,120,142,42,189,8,56,198,248,105,182,221,240,128,73,238,177,243,182,168,62,22,70,219,232,218,180,105,197,206,62,45,58,174,39,143,160,240,44,197,173,238,54,146,231,146,248,202,102,203,253,219,102,227,81,45,70,110,88,214,135,167,244,184,105,
198,39,200,137,84,139,25,213,201,38,78,157,244,132,171,88,71,139,59,217,165,137,13,144,123,160,173,167,151,159,86,45,155,90,219,230,83,27,155,187,218,72,25,232,32,251,64,7,254,160,118,146,99,160,179,163,189,189,147,108,144,29,252,147,31,49,3,157,131,
200,228,74,176,147,127,8,109,16,185,193,65,28,84,3,131,168,53,40,90,96,131,164,14,242,122,248,8,114,21,231,212,32,87,248,97,53,132,163,110,168,131,188,67,103,250,69,246,208,89,150,197,165,9,215,40,11,4,2,115,122,125,146,222,144,164,47,79,210,87,64,79,
179,244,246,176,54,30,35,135,38,98,10,55,114,25,212,134,245,48,165,104,242,4,164,2,109,116,244,236,145,146,216,48,101,241,67,113,253,84,60,110,26,221,81,52,169,143,146,99,216,68,114,18,82,28,22,228,24,17,231,28,57,71,68,56,31,37,59,206,83,45,74,105,35,
230,168,222,109,226,244,105,142,243,196,220,137,69,25,34,209,23,213,140,216,152,25,157,164,37,216,223,181,115,251,187,246,28,251,155,210,249,161,139,211,44,38,26,197,243,172,179,23,207,51,167,144,182,141,134,198,198,136,233,100,215,249,201,67,238,177,
249,51,102,148,82,225,126,205,214,68,44,224,234,252,177,46,143,112,74,135,153,111,97,204,140,30,141,81,10,79,242,245,33,23,215,100,33,55,247,98,222,124,95,104,82,23,141,94,172,135,198,39,226,148,13,53,40,157,125,147,209,59,2,31,52,68,190,229,212,148,
9,85,244,27,193,67,116,215,61,111,232,24,37,39,82,61,218,204,230,132,178,133,210,184,2,119,231,161,147,60,72,88,27,173,23,110,29,26,209,41,3,150,126,35,196,231,152,119,90,60,255,244,147,76,12,105,32,20,11,13,135,194,124,169,121,157,75,113,150,155,51,
125,230,78,116,207,55,151,22,133,194,58,130,122,36,172,237,110,143,106,24,156,13,185,155,197,231,22,98,19,148,137,137,196,114,99,226,186,181,41,238,7,158,57,67,143,30,67,128,154,179,172,159,115,25,74,183,44,56,52,90,205,25,184,224,92,178,63,66,57,115,
9,113,160,92,28,26,29,69,159,228,99,186,76,60,67,212,57,197,16,213,198,19,109,10,3,154,145,109,138,107,14,165,76,104,49,113,181,160,188,137,208,168,222,107,142,197,197,113,217,30,53,39,173,145,162,8,10,246,241,181,180,77,152,177,56,177,16,185,176,150,
155,68,92,138,145,26,154,156,164,76,126,213,13,105,225,22,45,18,235,194,12,83,186,52,244,234,225,54,99,116,46,31,201,222,184,22,141,83,134,52,132,98,122,103,127,75,27,165,138,3,187,111,119,68,39,183,80,183,89,135,55,57,66,8,137,59,117,60,50,214,97,196,
226,26,142,10,74,9,197,54,69,52,156,27,168,22,147,43,65,206,157,250,238,22,254,232,188,157,231,184,5,167,39,50,122,39,248,60,217,195,98,99,167,99,253,244,40,127,242,70,156,190,100,11,235,99,113,114,132,117,99,28,129,51,45,108,106,163,193,208,112,84,139,
238,38,135,236,18,51,200,102,240,5,119,26,250,204,70,177,242,102,120,116,66,124,206,80,150,105,36,46,203,45,81,93,139,99,153,179,231,77,173,122,44,30,53,119,243,181,159,55,74,255,72,170,153,112,144,162,121,83,175,54,173,39,102,0,115,136,237,157,84,94,
76,234,169,77,244,198,205,8,162,2,165,96,195,138,126,80,94,66,59,237,242,68,14,211,128,163,204,80,186,153,124,205,164,12,243,148,40,71,169,166,145,240,203,116,161,118,77,133,227,161,8,159,123,145,132,111,165,240,112,41,10,163,68,111,232,114,61,17,77,
220,56,209,248,161,35,66,1,30,104,45,159,211,146,219,80,111,10,65,47,142,40,98,143,8,191,116,69,180,40,74,138,189,108,143,136,240,197,162,84,18,213,199,249,106,70,207,253,117,132,156,60,6,226,210,73,41,82,217,70,62,30,15,167,117,107,48,155,140,211,130,
182,61,42,226,145,26,211,225,150,49,30,185,230,190,31,144,27,105,49,37,26,119,177,188,228,84,135,53,32,225,237,188,90,210,45,83,84,11,38,220,138,242,145,58,235,5,158,22,196,18,81,170,63,148,20,118,138,206,106,230,247,67,13,7,67,204,138,91,194,241,210,
99,167,196,43,87,34,25,182,250,116,105,40,28,222,104,198,197,226,186,99,240,250,68,236,64,69,164,230,118,59,10,115,7,178,250,133,11,11,178,225,61,243,201,252,152,213,155,142,249,103,201,145,218,226,19,33,156,152,252,179,44,32,101,61,172,60,216,171,104,
3,42,159,130,148,169,248,216,106,17,118,217,52,217,167,181,48,95,124,33,54,141,145,141,223,216,41,147,127,38,187,76,42,55,244,153,253,88,74,207,244,233,129,218,53,61,63,106,54,67,108,150,148,89,124,219,159,173,39,182,155,30,87,24,57,51,6,155,232,168,
66,206,234,33,85,121,154,165,239,87,217,83,44,123,145,74,151,43,181,179,127,216,209,196,178,178,66,77,74,172,184,137,30,82,20,122,151,57,51,148,243,183,40,23,205,212,208,87,21,118,18,201,51,228,183,208,88,198,33,122,212,18,171,212,217,163,236,78,230,
172,86,142,82,163,242,58,155,81,30,249,208,204,181,76,177,187,154,107,154,106,155,154,46,24,82,41,238,186,66,101,83,13,77,247,46,86,213,175,177,58,150,183,32,176,80,85,14,49,133,101,229,217,21,229,146,98,59,217,153,93,117,184,148,170,187,237,46,7,57,
152,67,113,168,149,149,202,116,181,93,169,84,98,213,212,96,61,186,65,57,201,246,40,80,254,196,7,246,49,31,237,130,216,64,79,168,202,123,236,106,110,191,134,219,233,123,42,255,124,71,85,118,152,144,191,83,217,14,136,231,132,64,157,61,54,174,92,231,163,
223,202,2,127,182,10,252,202,18,39,20,246,36,115,22,111,216,80,51,184,97,112,136,46,103,17,81,235,86,85,121,135,221,142,78,92,87,84,67,123,21,229,65,118,133,179,120,191,226,45,86,34,197,74,102,163,50,117,247,86,101,119,39,221,163,168,15,178,221,200,82,
210,63,162,76,23,127,122,104,199,126,149,222,102,202,32,221,106,213,201,216,239,247,125,154,14,170,246,93,95,97,111,178,231,153,129,71,94,167,218,254,143,29,100,223,96,135,209,254,218,253,131,244,73,38,74,42,143,81,177,242,240,85,197,27,212,212,9,37,
168,58,223,96,170,242,8,109,81,214,85,179,236,204,128,133,39,168,166,61,196,148,181,77,170,251,167,108,249,90,198,84,215,93,76,169,97,190,244,11,237,46,187,187,222,158,182,195,225,170,101,217,185,202,7,27,155,28,238,181,172,120,1,183,159,106,84,218,89,
113,6,221,175,178,19,232,128,95,101,175,97,145,188,185,138,187,90,153,44,134,171,124,176,106,161,157,184,172,40,181,211,139,129,74,186,87,101,95,231,235,241,184,202,194,206,140,144,143,94,102,236,45,24,30,85,233,30,86,88,187,99,195,236,246,130,253,148,
194,87,33,29,31,107,155,6,7,113,217,229,73,197,207,222,97,249,69,202,98,101,204,166,60,196,242,218,44,131,79,24,188,48,100,42,37,48,248,88,126,97,66,41,114,228,77,229,61,179,40,239,89,27,203,99,164,48,230,82,216,1,127,201,158,61,182,159,20,148,178,183,
11,72,117,144,251,128,31,222,164,148,93,189,199,118,184,136,93,235,127,149,127,236,243,225,227,54,31,83,14,129,99,62,178,101,22,100,42,76,252,87,162,224,190,98,100,223,237,199,199,97,191,109,175,66,169,128,253,13,248,64,13,123,202,207,216,190,197,140,
221,177,56,135,29,130,252,33,56,14,246,149,48,118,51,120,12,252,17,92,95,138,50,224,16,184,190,140,177,111,131,183,193,75,75,24,251,201,82,102,187,126,25,179,221,177,140,177,167,150,217,216,109,213,140,221,87,163,176,195,224,133,26,254,130,241,118,244,
243,217,90,141,29,175,117,16,163,236,2,54,247,63,140,156,7,234,196,111,124,137,223,51,19,50,241,94,50,255,61,46,241,110,50,255,253,46,241,126,178,141,230,223,81,230,191,255,37,222,83,118,208,252,187,202,170,199,170,195,127,87,101,126,235,125,185,159,
64,119,248,45,59,127,39,130,121,172,119,13,249,123,18,138,223,122,46,127,183,89,149,229,249,251,7,54,191,213,46,127,103,193,238,183,250,199,223,99,224,47,49,242,103,137,247,42,60,150,157,191,83,253,23,154,136,16,100,140,45,0,0,0,0 };

//==============================================================================
#if JUCE_PUSH_NOTIFICATIONS && JUCE_MODULE_AVAILABLE_juce_gui_extra
 // Returns true if the intent was handled.
 extern bool juce_handleNotificationIntent (void*);
 extern void juce_firebaseDeviceNotificationsTokenRefreshed (void*);
 extern void juce_firebaseRemoteNotificationReceived (void*);
 extern void juce_firebaseRemoteMessagesDeleted();
 extern void juce_firebaseRemoteMessageSent(void*);
 extern void juce_firebaseRemoteMessageSendError (void*, void*);
#endif

//==============================================================================
#define JNI_CLASS_MEMBERS(METHOD, STATICMETHOD, FIELD, STATICFIELD, CALLBACK) \
 METHOD (create,                      "<init>",                      "(II)V")

DECLARE_JNI_CLASS (AndroidLayoutParams, "android/view/ViewGroup$LayoutParams")
#undef JNI_CLASS_MEMBERS

//==============================================================================
#define JNI_CLASS_MEMBERS(METHOD, STATICMETHOD, FIELD, STATICFIELD, CALLBACK) \
 METHOD (addView,       "addView",             "(Landroid/view/View;Landroid/view/ViewGroup$LayoutParams;)V") \
 METHOD (removeView, "removeView", "(Landroid/view/View;)V") \
 METHOD (updateViewLayout, "updateViewLayout", "(Landroid/view/View;Landroid/view/ViewGroup$LayoutParams;)V")

DECLARE_JNI_CLASS (AndroidViewManager, "android/view/ViewManager")
#undef JNI_CLASS_MEMBERS

//==============================================================================
#define JNI_CLASS_MEMBERS(METHOD, STATICMETHOD, FIELD, STATICFIELD, CALLBACK) \
 METHOD (create,           "<init>",             "(IIIIIII)V") \
 FIELD  (gravity,          "gravity",            "I") \
 FIELD  (windowAnimations, "windowAnimations",   "I")

DECLARE_JNI_CLASS (AndroidWindowManagerLayoutParams, "android/view/WindowManager$LayoutParams")
#undef JNI_CLASS_MEMBERS

//==============================================================================
#define JNI_CLASS_MEMBERS(METHOD, STATICMETHOD, FIELD, STATICFIELD, CALLBACK) \
 METHOD (getDecorView, "getDecorView",       "()Landroid/view/View;") \
 METHOD (setFlags,     "setFlags",           "(II)V") \
 METHOD (clearFlags,   "clearFlags",         "(I)V")

DECLARE_JNI_CLASS (AndroidWindow, "android/view/Window")
#undef JNI_CLASS_MEMBERS

namespace
{
    enum
    {
        SYSTEM_UI_FLAG_VISIBLE = 0,
        SYSTEM_UI_FLAG_LOW_PROFILE = 1,
        SYSTEM_UI_FLAG_HIDE_NAVIGATION = 2,
        SYSTEM_UI_FLAG_FULLSCREEN = 4,
        SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION = 512,
        SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN = 1024,
        SYSTEM_UI_FLAG_IMMERSIVE = 2048,
        SYSTEM_UI_FLAG_IMMERSIVE_STICKY = 4096
    };

    constexpr int fullScreenFlags = SYSTEM_UI_FLAG_HIDE_NAVIGATION | SYSTEM_UI_FLAG_FULLSCREEN | SYSTEM_UI_FLAG_IMMERSIVE_STICKY;

    constexpr int FLAG_NOT_FOCUSABLE = 0x8;
}

//==============================================================================
class AndroidComponentPeer  : public ComponentPeer,
                              private Timer
{
public:
    AndroidComponentPeer (Component& comp, int windowStyleFlags, void* nativeViewHandle)
        : ComponentPeer (comp, windowStyleFlags),
          fullScreen (false),
          navBarsHidden (false),
          sizeAllocated (0),
          scale ((float) Desktop::getInstance().getDisplays().getMainDisplay().scale)
    {
        auto* env = getEnv();

        // NB: must not put this in the initialiser list, as it invokes a callback,
        // which will fail if the peer is only half-constructed.
        view = GlobalRef (LocalRef<jobject> (env->NewObject (ComponentPeerView, ComponentPeerView.create,
                                                             getAppContext().get(), (jboolean) component.isOpaque(),
                                                             (jlong) this)));

        if (nativeViewHandle != nullptr)
        {
            viewGroupIsWindow = false;

            // we don't know if the user is holding on to a local ref to this, so
            // explicitly create a new one
            auto nativeView = LocalRef<jobject>(env->NewLocalRef(static_cast<jobject> (nativeViewHandle)));

            if (env->IsInstanceOf (nativeView.get(), AndroidActivity))
            {
                viewGroup = GlobalRef (nativeView);
                env->CallVoidMethod (viewGroup.get(), AndroidActivity.setContentView, view.get());
            }
            else if (env->IsInstanceOf (nativeView.get(), AndroidViewGroup))
            {
                viewGroup = GlobalRef (nativeView);
                LocalRef<jobject> layoutParams (env->NewObject (AndroidLayoutParams, AndroidLayoutParams.create, -2, -2));

                env->CallVoidMethod (view.get(), AndroidView.setLayoutParams, layoutParams.get());
                env->CallVoidMethod ((jobject) viewGroup.get(), AndroidViewGroup.addView, view.get());
            }
            else
            {
                // the native handle you passed as a second argument to Component::addToDesktop must
                // either be an Activity or a ViewGroup
                jassertfalse;
            }
        }
        else
        {
            viewGroupIsWindow = true;

            LocalRef<jobject> viewLayoutParams (env->NewObject (AndroidLayoutParams, AndroidLayoutParams.create, -2, -2));

            env->CallVoidMethod (view.get(), AndroidView.setLayoutParams, viewLayoutParams.get());

            Rectangle<int> physicalBounds = comp.getBoundsInParent() * scale;

            view.callVoidMethod (AndroidView.layout,
                                 physicalBounds.getX(), physicalBounds.getY(), physicalBounds.getRight(), physicalBounds.getBottom());

            LocalRef<jobject> windowLayoutParams (env->NewObject (AndroidWindowManagerLayoutParams, AndroidWindowManagerLayoutParams.create,
                                                                  physicalBounds.getWidth(), physicalBounds.getHeight(),
                                                                  physicalBounds.getX(), physicalBounds.getY(),
                                                                  TYPE_APPLICATION, FLAG_NOT_TOUCH_MODAL | FLAG_LAYOUT_IN_SCREEN | FLAG_NOT_FOCUSABLE,
                                                                  component.isOpaque() ? PIXEL_FORMAT_OPAQUE : PIXEL_FORMAT_TRANSPARENT));
            env->SetIntField (windowLayoutParams.get(), AndroidWindowManagerLayoutParams.gravity, GRAVITY_LEFT | GRAVITY_TOP);
            env->SetIntField (windowLayoutParams.get(), AndroidWindowManagerLayoutParams.windowAnimations, 0x01030000 /* android.R.style.Animation */);

            if (Desktop::getInstance().getKioskModeComponent() != nullptr)
                setNavBarsHidden (true);

            LocalRef<jobject> activity (getCurrentActivity());

            if (activity == nullptr)
                activity = getMainActivity();

            viewGroup = GlobalRef (LocalRef<jobject> (env->CallObjectMethod (activity.get(), AndroidContext.getSystemService, javaString ("window").get())));
            env->CallVoidMethod (viewGroup.get(), AndroidViewManager.addView, view.get(), windowLayoutParams.get());
        }

        if (isFocused())
            handleFocusGain();
    }

    ~AndroidComponentPeer() override
    {
        auto* env = getEnv();

        env->CallVoidMethod (view, ComponentPeerView.clear);
        frontWindow = nullptr;

        if (MessageManager::getInstance()->isThisTheMessageThread())
        {
            if (env->IsInstanceOf (viewGroup.get(), AndroidActivity))
                env->CallVoidMethod (viewGroup.get(), AndroidActivity.setContentView, nullptr);
            else
                env->CallVoidMethod (viewGroup.get(), AndroidViewManager.removeView, view.get());
        }
        else
        {
            struct ViewDeleter  : public CallbackMessage
            {
                ViewDeleter (const GlobalRef& view_, const GlobalRef& viewGroup_) : view (view_), group (viewGroup_) {}

                void messageCallback() override
                {
                    auto* callbackEnv = getEnv();

                    if (callbackEnv->IsInstanceOf (group.get(), AndroidActivity))
                        callbackEnv->CallVoidMethod (group.get(), AndroidActivity.setContentView, nullptr);
                    else
                        callbackEnv->CallVoidMethod (group.get(), AndroidViewManager.removeView, view.get());
                }

            private:
                GlobalRef view, group;
            };

            (new ViewDeleter (view, viewGroup))->post();
        }
    }

    void* getNativeHandle() const override
    {
        return (void*) view.get();
    }

    void setVisible (bool shouldBeVisible) override
    {
        if (MessageManager::getInstance()->isThisTheMessageThread())
        {
            view.callVoidMethod (ComponentPeerView.setVisible, shouldBeVisible);
        }
        else
        {
            struct VisibilityChanger  : public CallbackMessage
            {
                VisibilityChanger (const GlobalRef& view_, bool shouldBeVisible_)
                    : view (view_), shouldBeVisible (shouldBeVisible_)
                {}

                void messageCallback() override
                {
                    view.callVoidMethod (ComponentPeerView.setVisible, shouldBeVisible);
                }

                GlobalRef view;
                bool shouldBeVisible;
            };

            (new VisibilityChanger (view, shouldBeVisible))->post();
        }
    }

    void setTitle (const String& title) override
    {
        view.callVoidMethod (ComponentPeerView.setViewName, javaString (title).get());
    }

    void setBounds (const Rectangle<int>& userRect, bool isNowFullScreen) override
    {
        Rectangle<int> r = (userRect.toFloat() * scale).toNearestInt();

        if (MessageManager::getInstance()->isThisTheMessageThread())
        {
            auto* env = getEnv();

            fullScreen = isNowFullScreen;

            {
                view.callVoidMethod (AndroidView.layout,
                                     r.getX(), r.getY(), r.getRight(), r.getBottom());

                if (viewGroup != nullptr && viewGroupIsWindow)
                {
                    LocalRef<jobject> windowLayoutParams (env->NewObject (AndroidWindowManagerLayoutParams, AndroidWindowManagerLayoutParams.create,
                                                                          r.getWidth(), r.getHeight(),
                                                                          r.getX(), r.getY(),
                                                                          TYPE_APPLICATION, FLAG_NOT_TOUCH_MODAL | FLAG_LAYOUT_IN_SCREEN,
                                                                          component.isOpaque() ? PIXEL_FORMAT_OPAQUE : PIXEL_FORMAT_TRANSPARENT));
                    env->SetIntField (windowLayoutParams.get(), AndroidWindowManagerLayoutParams.gravity, 0x3 /* LEFT */ | 0x30 /* TOP */);
                    env->CallVoidMethod (viewGroup.get(), AndroidViewManager.updateViewLayout, view.get(), windowLayoutParams.get());
                }
            }
        }
        else
        {
            class ViewMover  : public CallbackMessage
            {
            public:
                ViewMover (const GlobalRef& v, Rectangle<int> boundsToUse)  : view (v), bounds (boundsToUse) {}

                void messageCallback() override
                {
                    view.callVoidMethod (AndroidView.layout,
                                         bounds.getX(), bounds.getY(), bounds.getRight(), bounds.getBottom());
                }

            private:
                GlobalRef view;
                Rectangle<int> bounds;
            };

            (new ViewMover (view, r))->post();
        }
    }

    Rectangle<int> getBounds() const override
    {
        Rectangle<int> r (view.callIntMethod (AndroidView.getLeft),
                          view.callIntMethod (AndroidView.getTop),
                          view.callIntMethod (AndroidView.getWidth),
                          view.callIntMethod (AndroidView.getHeight));

        return r / scale;
    }

    void handleScreenSizeChange() override
    {
        ComponentPeer::handleScreenSizeChange();

        if (isFullScreen())
            setFullScreen (true);
    }

    Point<int> getScreenPosition() const
    {
        auto* env = getEnv();

        LocalRef<jintArray> position (env->NewIntArray (2));
        env->CallVoidMethod (view.get(), AndroidView.getLocationOnScreen, position.get());

        jint* const screenPosition = env->GetIntArrayElements (position.get(), nullptr);
        Point<int> pos (screenPosition[0], screenPosition[1]);
        env->ReleaseIntArrayElements (position.get(), screenPosition, 0);

        return pos;
    }

    Point<float> localToGlobal (Point<float> relativePosition) override
    {
        return relativePosition + (getScreenPosition().toFloat() / scale);
    }

    using ComponentPeer::localToGlobal;

    Point<float> globalToLocal (Point<float> screenPosition) override
    {
        return screenPosition - (getScreenPosition().toFloat() / scale);
    }

    using ComponentPeer::globalToLocal;

    void setMinimised (bool /*shouldBeMinimised*/) override
    {
        // n/a
    }

    bool isMinimised() const override
    {
        return false;
    }

    bool shouldNavBarsBeHidden (bool shouldBeFullScreen) const
    {
        if (shouldBeFullScreen)
            if (Component* kiosk = Desktop::getInstance().getKioskModeComponent())
                if (kiosk->getPeer() == this)
                    return true;

        return false;
    }

    void setNavBarsHidden (bool hidden)
    {
        view.callVoidMethod (ComponentPeerView.setSystemUiVisibilityCompat,
                             hidden ? (jint) (fullScreenFlags)
                                    : (jint) (SYSTEM_UI_FLAG_VISIBLE));

        navBarsHidden = hidden;
    }

    void setFullScreen (bool shouldBeFullScreen) override
    {
        // updating the nav bar visibility is a bit odd on Android - need to wait for
        if (shouldNavBarsBeHidden (shouldBeFullScreen))
        {
            if (! isTimerRunning())
            {
                startTimer (500);
            }
        }
        else
        {
            setNavBarsHidden (false);
        }

        Rectangle<int> r (shouldBeFullScreen ? Desktop::getInstance().getDisplays().getMainDisplay().userArea
                                             : lastNonFullscreenBounds);

        if ((! shouldBeFullScreen) && r.isEmpty())
            r = getBounds();

        // (can't call the component's setBounds method because that'll reset our fullscreen flag)
        if (! r.isEmpty())
            setBounds (r, shouldBeFullScreen);

        component.repaint();
    }

    bool isFullScreen() const override
    {
        return fullScreen;
    }

    void timerCallback() override
    {
        setNavBarsHidden (shouldNavBarsBeHidden (fullScreen));
        setFullScreen (fullScreen);
        stopTimer();
    }

    void setIcon (const Image& /*newIcon*/) override
    {
        // n/a
    }

    bool contains (Point<int> localPos, bool trueIfInAChildWindow) const override
    {
        return isPositiveAndBelow (localPos.x, component.getWidth())
            && isPositiveAndBelow (localPos.y, component.getHeight())
            && ((! trueIfInAChildWindow) || view.callBooleanMethod (ComponentPeerView.containsPoint,
                                                                    localPos.x * scale,
                                                                    localPos.y * scale));
    }

    BorderSize<int> getFrameSize() const override
    {
        // TODO
        return BorderSize<int>();
    }

    bool setAlwaysOnTop (bool /*alwaysOnTop*/) override
    {
        // TODO
        return false;
    }

    void toFront (bool makeActive) override
    {
        // Avoid calling bringToFront excessively: it's very slow
        if (frontWindow != this)
        {
            view.callVoidMethod (AndroidView.bringToFront);

            frontWindow = this;
        }

        if (makeActive)
            grabFocus();

        handleBroughtToFront();
    }

    void toBehind (ComponentPeer*) override
    {
        // TODO
    }

    //==============================================================================
    void handleMouseDownCallback (int index, Point<float> sysPos, int64 time)
    {
        lastMousePos = sysPos / scale;
        Point<float> pos = globalToLocal (lastMousePos);

        // this forces a mouse-enter/up event, in case for some reason we didn't get a mouse-up before.
        handleMouseEvent (MouseInputSource::InputSourceType::touch, pos, ModifierKeys::currentModifiers.withoutMouseButtons(),
                          MouseInputSource::invalidPressure, MouseInputSource::invalidOrientation, time, {}, index);

        if (isValidPeer (this))
            handleMouseDragCallback (index, sysPos, time);
    }

    void handleMouseDragCallback (int index, Point<float> sysPos, int64 time)
    {
        lastMousePos = sysPos / scale;
        Point<float> pos = globalToLocal (lastMousePos);

        jassert (index < 64);
        touchesDown = (touchesDown | (1 << (index & 63)));
        ModifierKeys::currentModifiers = ModifierKeys::currentModifiers.withoutMouseButtons().withFlags (ModifierKeys::leftButtonModifier);
        handleMouseEvent (MouseInputSource::InputSourceType::touch, pos, ModifierKeys::currentModifiers.withoutMouseButtons().withFlags (ModifierKeys::leftButtonModifier),
                          MouseInputSource::invalidPressure, MouseInputSource::invalidOrientation, time, {}, index);
    }

    void handleMouseUpCallback (int index, Point<float> sysPos, int64 time)
    {
        lastMousePos = sysPos / scale;
        Point<float> pos = globalToLocal (lastMousePos);

        jassert (index < 64);
        touchesDown = (touchesDown & ~(1 << (index & 63)));

        if (touchesDown == 0)
            ModifierKeys::currentModifiers = ModifierKeys::currentModifiers.withoutMouseButtons();

        handleMouseEvent (MouseInputSource::InputSourceType::touch, pos, ModifierKeys::currentModifiers.withoutMouseButtons(), MouseInputSource::invalidPressure,
                          MouseInputSource::invalidOrientation, time, {}, index);
    }

    void handleKeyDownCallback (int k, int kc)
    {
        handleKeyPress (k, static_cast<juce_wchar> (kc));
    }

    void handleKeyUpCallback (int /*k*/, int /*kc*/)
    {
    }

    void handleBackButtonCallback()
    {
        bool handled = false;

        if (auto* app = JUCEApplicationBase::getInstance())
            handled = app->backButtonPressed();

        if (Component* kiosk = Desktop::getInstance().getKioskModeComponent())
            if (kiosk->getPeer() == this)
                setNavBarsHidden (navBarsHidden);

        if (! handled)
        {
            auto* env = getEnv();
            LocalRef<jobject> activity (getCurrentActivity());

            if (activity != nullptr)
            {
                jmethodID finishMethod = env->GetMethodID (AndroidActivity, "finish", "()V");

                if (finishMethod != nullptr)
                    env->CallVoidMethod (activity.get(), finishMethod);
            }
        }

    }

    void handleKeyboardHiddenCallback()
    {
        Component::unfocusAllComponents();
    }

    void handleAppPausedCallback() {}

    void handleAppResumedCallback()
    {
        if (Component* kiosk = Desktop::getInstance().getKioskModeComponent())
            if (kiosk->getPeer() == this)
                setNavBarsHidden (navBarsHidden);
    }

    //==============================================================================
    bool isFocused() const override
    {
        if (view != nullptr)
            return view.callBooleanMethod (AndroidView.hasFocus);

        return false;
    }

    void grabFocus() override
    {
        if (view != nullptr)
            view.callBooleanMethod (AndroidView.requestFocus);
    }

    void handleFocusChangeCallback (bool hasFocus)
    {
        if (isFullScreen())
            setFullScreen (true);

        if (hasFocus)
            handleFocusGain();
        else
            handleFocusLoss();
    }

    static const char* getVirtualKeyboardType (TextInputTarget::VirtualKeyboardType type) noexcept
    {
        switch (type)
        {
            case TextInputTarget::textKeyboard:          return "text";
            case TextInputTarget::numericKeyboard:       return "number";
            case TextInputTarget::decimalKeyboard:       return "numberDecimal";
            case TextInputTarget::urlKeyboard:           return "textUri";
            case TextInputTarget::emailAddressKeyboard:  return "textEmailAddress";
            case TextInputTarget::phoneNumberKeyboard:   return "phone";
            default:                                     jassertfalse; break;
        }

        return "text";
    }

    void textInputRequired (Point<int>, TextInputTarget& target) override
    {
        view.callVoidMethod (ComponentPeerView.showKeyboard,
                             javaString (getVirtualKeyboardType (target.getKeyboardType())).get());
    }

    void dismissPendingTextInput() override
    {
        view.callVoidMethod (ComponentPeerView.showKeyboard, javaString ("").get());

        // updating the nav bar visibility is a bit odd on Android - need to wait for
        if (! isTimerRunning())
            hideNavBarDelayed();
     }

    void hideNavBarDelayed()
    {
        startTimer (500);
    }

    //==============================================================================
    void handlePaintCallback (jobject canvas, jobject paint)
    {
        auto* env = getEnv();

        jobject rect = env->CallObjectMethod (canvas, AndroidCanvas.getClipBounds);
        const int left   = env->GetIntField (rect, AndroidRect.left);
        const int top    = env->GetIntField (rect, AndroidRect.top);
        const int right  = env->GetIntField (rect, AndroidRect.right);
        const int bottom = env->GetIntField (rect, AndroidRect.bottom);
        env->DeleteLocalRef (rect);

        const Rectangle<int> clip (left, top, right - left, bottom - top);

        const int sizeNeeded = clip.getWidth() * clip.getHeight();
        if (sizeAllocated < sizeNeeded)
        {
            buffer.clear();
            sizeAllocated = sizeNeeded;
            buffer = GlobalRef (LocalRef<jobject> ((jobject) env->NewIntArray (sizeNeeded)));
        }
        else if (sizeNeeded == 0)
        {
            return;
        }

        if (jint* dest = env->GetIntArrayElements ((jintArray) buffer.get(), nullptr))
        {
            {
                Image temp (new PreallocatedImage (clip.getWidth(), clip.getHeight(),
                                                   dest, ! component.isOpaque()));

                {
                    LowLevelGraphicsSoftwareRenderer g (temp);
                    g.setOrigin (-clip.getPosition());
                    g.addTransform (AffineTransform::scale (scale));
                    handlePaint (g);
                }
            }

            env->ReleaseIntArrayElements ((jintArray) buffer.get(), dest, 0);

            env->CallVoidMethod (canvas, AndroidCanvas.drawBitmap, (jintArray) buffer.get(), 0, clip.getWidth(),
                                 (jfloat) clip.getX(), (jfloat) clip.getY(),
                                 clip.getWidth(), clip.getHeight(), true, paint);
        }
    }

    void repaint (const Rectangle<int>& userArea) override
    {
        Rectangle<int> area = userArea * scale;

        if (MessageManager::getInstance()->isThisTheMessageThread())
        {
            view.callVoidMethod (AndroidView.invalidate, area.getX(), area.getY(), area.getRight(), area.getBottom());
        }
        else
        {
            struct ViewRepainter  : public CallbackMessage
            {
                ViewRepainter (const GlobalRef& view_, const Rectangle<int>& area_)
                    : view (view_), area (area_) {}

                void messageCallback() override
                {
                    view.callVoidMethod (AndroidView.invalidate, area.getX(), area.getY(),
                                         area.getRight(), area.getBottom());
                }

            private:
                GlobalRef view;
                const Rectangle<int> area;
            };

            (new ViewRepainter (view, area))->post();
        }
    }

    void performAnyPendingRepaintsNow() override
    {
        // TODO
    }

    void setAlpha (float /*newAlpha*/) override
    {
        // TODO
    }

    StringArray getAvailableRenderingEngines() override
    {
        return StringArray ("Software Renderer");
    }

    //==============================================================================
    static Point<float> lastMousePos;
    static int64 touchesDown;

    //==============================================================================
    struct StartupActivityCallbackListener : ActivityLifecycleCallbacks
    {
        void onActivityStarted (jobject /*activity*/) override
        {
            auto* env = getEnv();
            LocalRef<jobject> appContext (getAppContext());

            if (appContext.get() != nullptr)
            {

                env->CallVoidMethod (appContext.get(),
                                     AndroidApplication.unregisterActivityLifecycleCallbacks,
                                     activityCallbackListener.get());
                clear();
                activityCallbackListener.clear();

                const_cast<Displays &> (Desktop::getInstance().getDisplays()).refresh();
            }
        }
    };

private:
    //==============================================================================
    GlobalRef view, viewGroup;
    bool viewGroupIsWindow = false;
    GlobalRef buffer;
    bool fullScreen;
    bool navBarsHidden;
    int sizeAllocated;
    float scale;

    //==============================================================================
    #define JNI_CLASS_MEMBERS(METHOD, STATICMETHOD, FIELD, STATICFIELD, CALLBACK) \
     METHOD   (create,                      "<init>",                      "(Landroid/content/Context;ZJ)V") \
     METHOD   (clear,                       "clear",                       "()V") \
     METHOD   (setViewName,                 "setViewName",                 "(Ljava/lang/String;)V") \
     METHOD   (setVisible,                  "setVisible",                  "(Z)V") \
     METHOD   (isVisible,                   "isVisible",                   "()Z") \
     METHOD   (containsPoint,               "containsPoint",               "(II)Z") \
     METHOD   (showKeyboard,                "showKeyboard",                "(Ljava/lang/String;)V") \
     METHOD   (setSystemUiVisibilityCompat, "setSystemUiVisibilityCompat", "(I)V") \
     CALLBACK (handlePaintJni,              "handlePaint",                 "(JLandroid/graphics/Canvas;Landroid/graphics/Paint;)V") \
     CALLBACK (handleMouseDownJni,          "handleMouseDown",             "(JIFFJ)V") \
     CALLBACK (handleMouseDragJni,          "handleMouseDrag",             "(JIFFJ)V") \
     CALLBACK (handleMouseUpJni,            "handleMouseUp",               "(JIFFJ)V") \
     CALLBACK (handleKeyDownJni,            "handleKeyDown",               "(JII)V") \
     CALLBACK (handleKeyUpJni,              "handleKeyUp",                 "(JII)V") \
     CALLBACK (handleBackButtonJni,         "handleBackButton",            "(J)V") \
     CALLBACK (handleKeyboardHiddenJni,     "handleKeyboardHidden",        "(J)V") \
     CALLBACK (viewSizeChangedJni,          "viewSizeChanged",             "(J)V") \
     CALLBACK (focusChangedJni,             "focusChanged",                "(JZ)V") \
     CALLBACK (handleAppPausedJni,          "handleAppPaused",             "(J)V") \
     CALLBACK (handleAppResumedJni,         "handleAppResumed",            "(J)V") \

    DECLARE_JNI_CLASS_WITH_BYTECODE (ComponentPeerView, "com/rmsl/juce/ComponentPeerView", 23, javaComponentPeerView, sizeof (javaComponentPeerView))
//    DECLARE_JNI_CLASS_WITH_MIN_SDK (ComponentPeerView, "com/rmsl/juce/ComponentPeerView", 16)    
    #undef JNI_CLASS_MEMBERS

    static void JNICALL handlePaintJni          (JNIEnv*, jobject /*view*/, jlong host, jobject canvas, jobject paint)           { if (auto* myself = reinterpret_cast<AndroidComponentPeer*> (host)) myself->handlePaintCallback (canvas, paint); }
    static void JNICALL handleMouseDownJni      (JNIEnv*, jobject /*view*/, jlong host, jint i, jfloat x, jfloat y, jlong time)  { if (auto* myself = reinterpret_cast<AndroidComponentPeer*> (host)) myself->handleMouseDownCallback (i, Point<float> ((float) x, (float) y), (int64) time); }
    static void JNICALL handleMouseDragJni      (JNIEnv*, jobject /*view*/, jlong host, jint i, jfloat x, jfloat y, jlong time)  { if (auto* myself = reinterpret_cast<AndroidComponentPeer*> (host)) myself->handleMouseDragCallback (i, Point<float> ((float) x, (float) y), (int64) time); }
    static void JNICALL handleMouseUpJni        (JNIEnv*, jobject /*view*/, jlong host, jint i, jfloat x, jfloat y, jlong time)  { if (auto* myself = reinterpret_cast<AndroidComponentPeer*> (host)) myself->handleMouseUpCallback   (i, Point<float> ((float) x, (float) y), (int64) time); }
    static void JNICALL viewSizeChangedJni      (JNIEnv*, jobject /*view*/, jlong host)                                          { if (auto* myself = reinterpret_cast<AndroidComponentPeer*> (host)) myself->handleMovedOrResized(); }
    static void JNICALL focusChangedJni         (JNIEnv*, jobject /*view*/, jlong host, jboolean hasFocus)                       { if (auto* myself = reinterpret_cast<AndroidComponentPeer*> (host)) myself->handleFocusChangeCallback (hasFocus); }
    static void JNICALL handleKeyDownJni        (JNIEnv*, jobject /*view*/, jlong host, jint k, jint kc)                         { if (auto* myself = reinterpret_cast<AndroidComponentPeer*> (host)) myself->handleKeyDownCallback ((int) k, (int) kc); }
    static void JNICALL handleKeyUpJni          (JNIEnv*, jobject /*view*/, jlong host, jint k, jint kc)                         { if (auto* myself = reinterpret_cast<AndroidComponentPeer*> (host)) myself->handleKeyUpCallback ((int) k, (int) kc); }
    static void JNICALL handleBackButtonJni     (JNIEnv*, jobject /*view*/, jlong host)                                          { if (auto* myself = reinterpret_cast<AndroidComponentPeer*> (host)) myself->handleBackButtonCallback(); }
    static void JNICALL handleKeyboardHiddenJni (JNIEnv*, jobject /*view*/, jlong host)                                          { if (auto* myself = reinterpret_cast<AndroidComponentPeer*> (host)) myself->handleKeyboardHiddenCallback(); }
    static void JNICALL handleAppPausedJni      (JNIEnv*, jobject /*view*/, jlong host)                                          { if (auto* myself = reinterpret_cast<AndroidComponentPeer*> (host)) myself->handleAppPausedCallback(); }
    static void JNICALL handleAppResumedJni     (JNIEnv*, jobject /*view*/, jlong host)                                          { if (auto* myself = reinterpret_cast<AndroidComponentPeer*> (host)) myself->handleAppResumedCallback(); }

    //==============================================================================
    friend class Displays;
    static AndroidComponentPeer* frontWindow;
    static GlobalRef activityCallbackListener;

    //==============================================================================
    static constexpr int GRAVITY_LEFT = 0x3, GRAVITY_TOP = 0x30;
    static constexpr int TYPE_APPLICATION = 0x2;
    static constexpr int FLAG_NOT_TOUCH_MODAL = 0x20, FLAG_LAYOUT_IN_SCREEN = 0x100, FLAG_LAYOUT_NO_LIMITS = 0x200;
    static constexpr int PIXEL_FORMAT_OPAQUE = -1, PIXEL_FORMAT_TRANSPARENT = -2;

    struct PreallocatedImage  : public ImagePixelData
    {
        PreallocatedImage (int width_, int height_, jint* data_, bool hasAlpha_)
            : ImagePixelData (Image::ARGB, width_, height_), data (data_), hasAlpha (hasAlpha_)
        {
            if (hasAlpha_)
                zeromem (data_, static_cast<size_t> (width * height) * sizeof (jint));
        }

        ~PreallocatedImage() override
        {
            if (hasAlpha)
            {
                auto pix = (PixelARGB*) data;

                for (int i = width * height; --i >= 0;)
                {
                    pix->unpremultiply();
                    ++pix;
                }
            }
        }

        std::unique_ptr<ImageType> createType() const override
        {
            return std::make_unique<SoftwareImageType>();
        }

        std::unique_ptr<LowLevelGraphicsContext> createLowLevelContext() override
        {
            return std::make_unique<LowLevelGraphicsSoftwareRenderer> (Image (this));
        }

        void initialiseBitmapData (Image::BitmapData& bm, int x, int y, Image::BitmapData::ReadWriteMode /*mode*/) override
        {
            bm.lineStride = width * static_cast<int> (sizeof (jint));
            bm.pixelStride = static_cast<int> (sizeof (jint));
            bm.pixelFormat = Image::ARGB;
            bm.data = (uint8*) (data + x + y * width);
        }

        ImagePixelData::Ptr clone() override
        {
            auto s = new PreallocatedImage (width, height, nullptr, hasAlpha);
            s->allocatedData.malloc (sizeof (jint) * static_cast<size_t> (width * height));
            s->data = s->allocatedData;
            memcpy (s->data, data, sizeof (jint) * static_cast<size_t> (width * height));
            return s;
        }

    private:
        jint* data;
        HeapBlock<jint> allocatedData;
        bool hasAlpha;

        JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (PreallocatedImage)
    };

    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (AndroidComponentPeer)
};

Point<float> AndroidComponentPeer::lastMousePos;
int64 AndroidComponentPeer::touchesDown = 0;
AndroidComponentPeer* AndroidComponentPeer::frontWindow = nullptr;
GlobalRef AndroidComponentPeer::activityCallbackListener;
AndroidComponentPeer::ComponentPeerView_Class AndroidComponentPeer::ComponentPeerView;

//==============================================================================
ComponentPeer* Component::createNewPeer (int styleFlags, void* nativeWindow)
{
    return new AndroidComponentPeer (*this, styleFlags, nativeWindow);
}

//==============================================================================
bool Desktop::canUseSemiTransparentWindows() noexcept
{
    return true;
}

double Desktop::getDefaultMasterScale()
{
    return 1.0;
}

Desktop::DisplayOrientation Desktop::getCurrentOrientation() const
{
    enum
    {
        ROTATION_0   = 0,
        ROTATION_90  = 1,
        ROTATION_180 = 2,
        ROTATION_270 = 3
    };

    JNIEnv* env = getEnv();
    LocalRef<jstring> windowServiceString (javaString ("window"));


    LocalRef<jobject> windowManager = LocalRef<jobject> (env->CallObjectMethod (getAppContext().get(), AndroidContext.getSystemService, windowServiceString.get()));

    if (windowManager.get() != nullptr)
    {
        LocalRef<jobject> display = LocalRef<jobject> (env->CallObjectMethod (windowManager, AndroidWindowManager.getDefaultDisplay));

        if (display.get() != nullptr)
        {
            int rotation = env->CallIntMethod (display, AndroidDisplay.getRotation);

            switch (rotation)
            {
                case ROTATION_0:   return upright;
                case ROTATION_90:  return rotatedAntiClockwise;
                case ROTATION_180: return upsideDown;
                case ROTATION_270: return rotatedClockwise;
            }
        }
    }

    jassertfalse;
    return upright;
}

bool MouseInputSource::SourceList::addSource()
{
    addSource (sources.size(), MouseInputSource::InputSourceType::touch);
    return true;
}

bool MouseInputSource::SourceList::canUseTouch()
{
    return true;
}

Point<float> MouseInputSource::getCurrentRawMousePosition()
{
    return AndroidComponentPeer::lastMousePos;
}

void MouseInputSource::setRawMousePosition (Point<float>)
{
    // not needed
}

//==============================================================================
bool KeyPress::isKeyCurrentlyDown (int /*keyCode*/)
{
    // TODO
    return false;
}

JUCE_API void JUCE_CALLTYPE Process::hide()
{
    auto* env = getEnv();
    LocalRef<jobject> currentActivity (getCurrentActivity().get());

    if (env->CallBooleanMethod (currentActivity.get(), AndroidActivity.moveTaskToBack, true) == 0)
    {
        GlobalRef intent (LocalRef<jobject> (env->NewObject (AndroidIntent, AndroidIntent.constructor)));
        env->CallObjectMethod (intent, AndroidIntent.setAction,   javaString ("android.intent.action.MAIN")  .get());
        env->CallObjectMethod (intent, AndroidIntent.addCategory, javaString ("android.intent.category.HOME").get());

        env->CallVoidMethod (currentActivity.get(), AndroidContext.startActivity, intent.get());
    }
}

//==============================================================================
// TODO
JUCE_API bool JUCE_CALLTYPE Process::isForegroundProcess() { return true; }
JUCE_API void JUCE_CALLTYPE Process::makeForegroundProcess() {}

//==============================================================================
#define JNI_CLASS_MEMBERS(METHOD, STATICMETHOD, FIELD, STATICFIELD, CALLBACK) \
 METHOD (show,                   "show",                 "()V") \
 METHOD (getWindow,              "getWindow",            "()Landroid/view/Window;")

DECLARE_JNI_CLASS (AndroidDialog, "android/app/Dialog")
#undef JNI_CLASS_MEMBERS

#define JNI_CLASS_MEMBERS(METHOD, STATICMETHOD, FIELD, STATICFIELD, CALLBACK) \
 METHOD (construct,                   "<init>",                 "(Landroid/content/Context;)V") \
 METHOD (create,                      "create",                 "()Landroid/app/AlertDialog;") \
 METHOD (setTitle,                    "setTitle",               "(Ljava/lang/CharSequence;)Landroid/app/AlertDialog$Builder;") \
 METHOD (setMessage,                  "setMessage",             "(Ljava/lang/CharSequence;)Landroid/app/AlertDialog$Builder;") \
 METHOD (setCancelable,               "setCancelable",          "(Z)Landroid/app/AlertDialog$Builder;") \
 METHOD (setOnCancelListener,         "setOnCancelListener",    "(Landroid/content/DialogInterface$OnCancelListener;)Landroid/app/AlertDialog$Builder;") \
 METHOD (setPositiveButton,           "setPositiveButton",      "(Ljava/lang/CharSequence;Landroid/content/DialogInterface$OnClickListener;)Landroid/app/AlertDialog$Builder;") \
 METHOD (setNegativeButton,           "setNegativeButton",      "(Ljava/lang/CharSequence;Landroid/content/DialogInterface$OnClickListener;)Landroid/app/AlertDialog$Builder;") \
 METHOD (setNeutralButton,            "setNeutralButton",       "(Ljava/lang/CharSequence;Landroid/content/DialogInterface$OnClickListener;)Landroid/app/AlertDialog$Builder;")

DECLARE_JNI_CLASS (AndroidAlertDialogBuilder, "android/app/AlertDialog$Builder")
#undef JNI_CLASS_MEMBERS

#define JNI_CLASS_MEMBERS(METHOD, STATICMETHOD, FIELD, STATICFIELD, CALLBACK) \
 METHOD (dismiss,    "dismiss",  "()V")

DECLARE_JNI_CLASS (AndroidDialogInterface, "android/content/DialogInterface")
#undef JNI_CLASS_MEMBERS

#define JNI_CLASS_MEMBERS(METHOD, STATICMETHOD, FIELD, STATICFIELD, CALLBACK) \

DECLARE_JNI_CLASS (AndroidDialogOnClickListener, "android/content/DialogInterface$OnClickListener")
#undef JNI_CLASS_MEMBERS

//==============================================================================
class DialogListener  : public juce::AndroidInterfaceImplementer
{
public:
    DialogListener (ModalComponentManager::Callback* callbackToUse, int resultToUse)
        : callback (callbackToUse), result (resultToUse)
    {}

    void onResult (jobject dialog)
    {
        auto* env = getEnv();
        env->CallVoidMethod (dialog, AndroidDialogInterface.dismiss);

        if (callback != nullptr)
            callback->modalStateFinished (result);

        callback = nullptr;
    }

private:
    jobject invoke (jobject proxy, jobject method, jobjectArray args) override
    {
        auto* env = getEnv();
        auto methodName = juce::juceString ((jstring) env->CallObjectMethod (method, JavaMethod.getName));

        if (methodName == "onCancel" || methodName == "onClick")
        {
            onResult (env->GetObjectArrayElement (args, 0));
            return nullptr;
        }

        // invoke base class
        return AndroidInterfaceImplementer::invoke (proxy, method, args);
    }

    std::unique_ptr<ModalComponentManager::Callback> callback;
    int result;
};

//==============================================================================
static void createAndroidDialog (const String& title, const String& message,
                                 ModalComponentManager::Callback* callback,
                                 const String& positiveButton = {}, const String& negativeButton = {},
                                 const String& neutralButton = {})
{
    auto* env = getEnv();

    LocalRef<jobject> builder (env->NewObject (AndroidAlertDialogBuilder, AndroidAlertDialogBuilder.construct, getMainActivity().get()));

    builder = LocalRef<jobject> (env->CallObjectMethod (builder.get(), AndroidAlertDialogBuilder.setTitle,   javaString (title).get()));
    builder = LocalRef<jobject> (env->CallObjectMethod (builder.get(), AndroidAlertDialogBuilder.setMessage, javaString (message).get()));
    builder = LocalRef<jobject> (env->CallObjectMethod (builder.get(), AndroidAlertDialogBuilder.setCancelable, true));

    builder = LocalRef<jobject> (env->CallObjectMethod (builder.get(), AndroidAlertDialogBuilder.setOnCancelListener,
                                     CreateJavaInterface (new DialogListener (callback, 0),
                                                          "android/content/DialogInterface$OnCancelListener").get()));

    auto positiveButtonText = positiveButton.isEmpty() ? String ("OK") : positiveButton;

    builder = LocalRef<jobject> (env->CallObjectMethod (builder.get(), AndroidAlertDialogBuilder.setPositiveButton,
                                     javaString (positiveButtonText).get(),
                                     CreateJavaInterface (new DialogListener (callback, positiveButton.isEmpty() ? 0 : 1),
                                                          "android/content/DialogInterface$OnClickListener").get()));

    if (negativeButton.isNotEmpty())
        builder = LocalRef<jobject> (env->CallObjectMethod (builder.get(), AndroidAlertDialogBuilder.setNegativeButton,
                                         javaString (negativeButton).get(),
                                         CreateJavaInterface (new DialogListener (callback, neutralButton.isEmpty() ? 0 : 2),
                                                              "android/content/DialogInterface$OnClickListener").get()));

    if (neutralButton.isNotEmpty())
        builder = LocalRef<jobject> (env->CallObjectMethod (builder.get(), AndroidAlertDialogBuilder.setNegativeButton,
                                         javaString (neutralButton).get(),
                                         CreateJavaInterface (new DialogListener (callback, 0),
                                                              "android/content/DialogInterface$OnClickListener").get()));

    LocalRef<jobject> dialog (env->CallObjectMethod (builder.get(), AndroidAlertDialogBuilder.create));

    LocalRef<jobject> window (env->CallObjectMethod (dialog.get(), AndroidDialog.getWindow));

    if (Desktop::getInstance().getKioskModeComponent() != nullptr)
    {
        env->CallVoidMethod (window.get(), AndroidWindow.setFlags, FLAG_NOT_FOCUSABLE, FLAG_NOT_FOCUSABLE);
        LocalRef<jobject> decorView (env->CallObjectMethod (window.get(), AndroidWindow.getDecorView));
        env->CallVoidMethod (decorView.get(), AndroidView.setSystemUiVisibility, fullScreenFlags);
    }

    env->CallVoidMethod (dialog.get(), AndroidDialog.show);

    if (Desktop::getInstance().getKioskModeComponent() != nullptr)
        env->CallVoidMethod (window.get(), AndroidWindow.clearFlags, FLAG_NOT_FOCUSABLE);
}

void JUCE_CALLTYPE NativeMessageBox::showMessageBoxAsync (AlertWindow::AlertIconType /*iconType*/,
                                                          const String& title, const String& message,
                                                          Component* /*associatedComponent*/,
                                                          ModalComponentManager::Callback* callback)
{
    createAndroidDialog (title, message, callback);
}

bool JUCE_CALLTYPE NativeMessageBox::showOkCancelBox (AlertWindow::AlertIconType /*iconType*/,
                                                      const String& title, const String& message,
                                                      Component* /*associatedComponent*/,
                                                      ModalComponentManager::Callback* callback)
{
    jassert (callback != nullptr); // on android, all alerts must be non-modal!!

    createAndroidDialog (title, message, callback, "OK", "Cancel");
    return false;
}

int JUCE_CALLTYPE NativeMessageBox::showYesNoCancelBox (AlertWindow::AlertIconType /*iconType*/,
                                                        const String& title, const String& message,
                                                        Component* /*associatedComponent*/,
                                                        ModalComponentManager::Callback* callback)
{
    jassert (callback != nullptr); // on android, all alerts must be non-modal!!

    createAndroidDialog (title, message, callback, "Yes", "No", "Cancel");
    return 0;
}

int JUCE_CALLTYPE NativeMessageBox::showYesNoBox (AlertWindow::AlertIconType /*iconType*/,
                                                   const String& title, const String& message,
                                                   Component* /*associatedComponent*/,
                                                   ModalComponentManager::Callback* callback)
{
    jassert (callback != nullptr); // on android, all alerts must be non-modal!!

    createAndroidDialog (title, message, callback, "Yes", "No");
    return 0;
}

//==============================================================================
static bool androidScreenSaverEnabled = true;

void Desktop::setScreenSaverEnabled (bool shouldEnable)
{
    constexpr auto FLAG_KEEP_SCREEN_ON = 0x80;

    if (shouldEnable != androidScreenSaverEnabled)
    {
        LocalRef<jobject> activity (getMainActivity());

        if (activity != nullptr)
        {
            auto* env = getEnv();

            LocalRef<jobject> mainWindow (env->CallObjectMethod (activity.get(), AndroidActivity.getWindow));
            env->CallVoidMethod (mainWindow.get(), AndroidWindow.setFlags, shouldEnable ? 0 : FLAG_KEEP_SCREEN_ON, FLAG_KEEP_SCREEN_ON);
        }

        androidScreenSaverEnabled = shouldEnable;
    }
}

bool Desktop::isScreenSaverEnabled()
{
    return androidScreenSaverEnabled;
}

//==============================================================================
void Desktop::setKioskComponent (Component* kioskComp, bool enableOrDisable, bool allowMenusAndBars)
{
    ignoreUnused (allowMenusAndBars);

    if (AndroidComponentPeer* peer = dynamic_cast<AndroidComponentPeer*> (kioskComp->getPeer()))
        peer->setFullScreen (enableOrDisable);
    else
        jassertfalse; // (this should have been checked by the caller)
}

//==============================================================================
static jint getAndroidOrientationFlag (int orientations) noexcept
{
    enum
    {
        SCREEN_ORIENTATION_LANDSCAPE          = 0,
        SCREEN_ORIENTATION_PORTRAIT           = 1,
        SCREEN_ORIENTATION_USER               = 2,
        SCREEN_ORIENTATION_REVERSE_LANDSCAPE  = 8,
        SCREEN_ORIENTATION_REVERSE_PORTRAIT   = 9,
        SCREEN_ORIENTATION_USER_LANDSCAPE     = 11,
        SCREEN_ORIENTATION_USER_PORTRAIT      = 12,
    };

    switch (orientations)
    {
        case Desktop::upright:                                          return (jint) SCREEN_ORIENTATION_PORTRAIT;
        case Desktop::upsideDown:                                       return (jint) SCREEN_ORIENTATION_REVERSE_PORTRAIT;
        case Desktop::upright + Desktop::upsideDown:                    return (jint) SCREEN_ORIENTATION_USER_PORTRAIT;
        case Desktop::rotatedAntiClockwise:                             return (jint) SCREEN_ORIENTATION_LANDSCAPE;
        case Desktop::rotatedClockwise:                                 return (jint) SCREEN_ORIENTATION_REVERSE_LANDSCAPE;
        case Desktop::rotatedClockwise + Desktop::rotatedAntiClockwise: return (jint) SCREEN_ORIENTATION_USER_LANDSCAPE;
        default:                                                        return (jint) SCREEN_ORIENTATION_USER;
    }
}

void Desktop::allowedOrientationsChanged()
{
    LocalRef<jobject> activity (getMainActivity());

    if (activity != nullptr)
        getEnv()->CallVoidMethod (activity.get(), AndroidActivity.setRequestedOrientation, getAndroidOrientationFlag (allowedOrientations));
}

//==============================================================================
bool juce_areThereAnyAlwaysOnTopWindows()
{
    return false;
}

//==============================================================================
#define JNI_CLASS_MEMBERS(METHOD, STATICMETHOD, FIELD, STATICFIELD, CALLBACK) \
 METHOD (create,          "<init>",         "()V") \
 FIELD  (density,         "density",        "F") \
 FIELD  (widthPixels,     "widthPixels",    "I") \
 FIELD  (heightPixels,    "heightPixels",   "I")

DECLARE_JNI_CLASS (AndroidDisplayMetrics, "android/util/DisplayMetrics")
#undef JNI_CLASS_MEMBERS

//==============================================================================
class LayoutChangeListener  : public juce::AndroidInterfaceImplementer
{
public:
    virtual void onLayoutChange (LocalRef<jobject> view, int left, int top, int right, int bottom,
                                 int oldLeft, int oldTop, int oldRight, int oldBottom) = 0;

private:
    jobject invoke (jobject proxy, jobject method, jobjectArray args) override
    {
        auto* env = getEnv();
        auto methodName = juce::juceString ((jstring) env->CallObjectMethod (method, JavaMethod.getName));

        if (methodName == "onLayoutChange")
        {
            jassert (env->GetArrayLength (args) == 9);

            LocalRef<jobject> view (env->GetObjectArrayElement (args, 0));
            int dims[8];

            for (int i = 1; i < 9; ++i)
            {
                LocalRef<jobject> integer (env->GetObjectArrayElement (args, i));
                dims[i - 1] = env->CallIntMethod (integer.get(), JavaInteger.intValue);
            }

            onLayoutChange (std::move (view), dims[0], dims[1], dims[2], dims[3],
                            dims[4], dims[5], dims[6], dims[7]);

            return nullptr;
        }

        // invoke base class
        return AndroidInterfaceImplementer::invoke (proxy, method, args);
    }

    std::unique_ptr<ModalComponentManager::Callback> callback;
};

//==============================================================================
class MainActivityWindowLayoutListener   : public LayoutChangeListener
{
public:
    void onLayoutChange (LocalRef<jobject> /*view*/, int left, int top, int right, int bottom,
                         int oldLeft, int oldTop, int oldRight, int oldBottom) override
    {
        auto newBounds = Rectangle<int>::leftTopRightBottom (left, top, right, bottom);
        auto oldBounds = Rectangle<int>::leftTopRightBottom (oldLeft, oldTop, oldRight, oldBottom);

        if (newBounds != oldBounds)
        {
            auto& displays = Desktop::getInstance().getDisplays();
            auto& mainDisplay = displays.getMainDisplay();

            Rectangle<int> userArea = newBounds / mainDisplay.scale;

            if (userArea != mainDisplay.userArea)
                const_cast<Displays&> (displays).refresh();
        }
    }
};

//==============================================================================
void Displays::findDisplays (float masterScale)
{
    auto* env = getEnv();

    LocalRef<jobject> usableSize (env->NewObject (AndroidPoint, AndroidPoint.create, 0, 0));
    LocalRef<jstring> windowServiceString (javaString ("window"));
    LocalRef<jobject> displayMetrics (env->NewObject (AndroidDisplayMetrics, AndroidDisplayMetrics.create));
    LocalRef<jobject> windowManager (env->CallObjectMethod (getAppContext().get(), AndroidContext.getSystemService, windowServiceString.get()));
    LocalRef <jobject> display (env->CallObjectMethod (windowManager, AndroidWindowManager.getDefaultDisplay));

    jmethodID getRealMetricsMethod = env->GetMethodID (AndroidDisplay, "getRealMetrics", "(Landroid/util/DisplayMetrics;)V");

    if (getRealMetricsMethod != nullptr)
        env->CallVoidMethod (display.get(), getRealMetricsMethod, displayMetrics.get());
    else
        env->CallVoidMethod (display.get(), AndroidDisplay.getMetrics, displayMetrics.get());

    env->CallVoidMethod (display.get(), AndroidDisplay.getSize, usableSize.get());

    Display d;

    d.isMain = true;
    d.scale = env->GetFloatField (displayMetrics.get(), AndroidDisplayMetrics.density);
    d.dpi = (d.scale * 160.f);
    d.scale *= masterScale;

    d.totalArea = Rectangle<int> (env->GetIntField (displayMetrics.get(), AndroidDisplayMetrics.widthPixels),
                                  env->GetIntField (displayMetrics.get(), AndroidDisplayMetrics.heightPixels)) / d.scale;

    d.userArea = Rectangle<int> (env->GetIntField (usableSize.get(), AndroidPoint.x),
                                 env->GetIntField (usableSize.get(), AndroidPoint.y)) / d.scale;

    // unfortunately usableSize still contains the nav bar
    // the best workaround is to try to get the size of the top-level view of
    // the main activity
    LocalRef<jobject> activity (getMainActivity());

    if (activity != nullptr)
    {
        LocalRef<jobject> mainWindow (env->CallObjectMethod (activity.get(), AndroidActivity.getWindow));
        LocalRef<jobject> decorView (env->CallObjectMethod (mainWindow.get(), AndroidWindow.getDecorView));
        LocalRef<jobject> contentView (env->CallObjectMethod (decorView.get(), AndroidView.findViewById, 0x01020002 /* android.R.id.content */));

        if (contentView != nullptr)
        {
            Rectangle<int> activityArea (env->CallIntMethod (contentView.get(), AndroidView.getLeft),
                                         env->CallIntMethod (contentView.get(), AndroidView.getTop),
                                         env->CallIntMethod (contentView.get(), AndroidView.getWidth),
                                         env->CallIntMethod (contentView.get(), AndroidView.getHeight));

            if (! activityArea.isEmpty())
                d.userArea = activityArea / d.scale;

            static bool hasAddedMainActivityListener = false;

            if (! hasAddedMainActivityListener)
            {
                hasAddedMainActivityListener = true;

                env->CallVoidMethod (contentView.get(), AndroidView.addOnLayoutChangeListener,
                                     CreateJavaInterface (new MainActivityWindowLayoutListener,
                                                          "android/view/View$OnLayoutChangeListener").get());
            }
        }
    }
    else
    {
        // the main activity may have not started yet so add an activity listener
        if (AndroidComponentPeer::activityCallbackListener == nullptr)
        {
            LocalRef<jobject> appContext (getAppContext());

            if (appContext.get() != nullptr)
            {
                AndroidComponentPeer::activityCallbackListener = GlobalRef (CreateJavaInterface (
                        new AndroidComponentPeer::StartupActivityCallbackListener,
                        "android/app/Application$ActivityLifecycleCallbacks"));

                env->CallVoidMethod (appContext.get(),
                                     AndroidApplication.registerActivityLifecycleCallbacks,
                                     AndroidComponentPeer::activityCallbackListener.get());
            }
        }
    }

    displays.add (d);
}

//==============================================================================
Image juce_createIconForFile (const File& /*file*/)
{
    return Image();
}

//==============================================================================
void* CustomMouseCursorInfo::create() const                                         { return nullptr; }
void* MouseCursor::createStandardMouseCursor (MouseCursor::StandardCursorType)      { return nullptr; }
void MouseCursor::deleteMouseCursor (void* /*cursorHandle*/, bool /*isStandard*/)   {}

//==============================================================================
void MouseCursor::showInWindow (ComponentPeer*) const   {}

//==============================================================================
bool DragAndDropContainer::performExternalDragDropOfFiles (const StringArray& /*files*/, bool /*canMove*/,
                                                           Component* /*srcComp*/, std::function<void()> /*callback*/)
{
    jassertfalse;    // no such thing on Android!
    return false;
}

bool DragAndDropContainer::performExternalDragDropOfText (const String& /*text*/, Component* /*srcComp*/,
                                                          std::function<void()> /*callback*/)
{
    jassertfalse;    // no such thing on Android!
    return false;
}

//==============================================================================
void LookAndFeel::playAlertSound()
{
}

//==============================================================================
#define JNI_CLASS_MEMBERS(METHOD, STATICMETHOD, FIELD, STATICFIELD, CALLBACK) \
 METHOD (getText,      "getText",            "()Ljava/lang/CharSequence;") \
 METHOD (setText,      "setText",            "(Ljava/lang/CharSequence;)V")

DECLARE_JNI_CLASS (AndroidClipboardManager, "android/content/ClipboardManager")
#undef JNI_CLASS_MEMBERS

//==============================================================================
void SystemClipboard::copyTextToClipboard (const String& text)
{
    auto* env = getEnv();

    LocalRef<jobject> clipboardManager (env->CallObjectMethod (getAppContext().get(), AndroidContext.getSystemService, javaString ("clipboard").get()));
    env->CallVoidMethod (clipboardManager.get(), AndroidClipboardManager.setText, javaString(text).get());
}

String SystemClipboard::getTextFromClipboard()
{
    auto* env = getEnv();

    LocalRef<jobject> clipboardManager (env->CallObjectMethod (getAppContext().get(), AndroidContext.getSystemService, javaString ("clipboard").get()));
    LocalRef<jobject> charSequence (env->CallObjectMethod (clipboardManager.get(), AndroidClipboardManager.getText));

    if (charSequence == nullptr)
        return {};

    return juceString(LocalRef<jstring> ((jstring) env->CallObjectMethod(charSequence.get(), JavaCharSequence.toString)));
}

//==============================================================================
const int extendedKeyModifier       = 0x10000;

const int KeyPress::spaceKey        = ' ';
const int KeyPress::returnKey       = 66;
const int KeyPress::escapeKey       = 4;
const int KeyPress::backspaceKey    = 67;
const int KeyPress::leftKey         = extendedKeyModifier + 1;
const int KeyPress::rightKey        = extendedKeyModifier + 2;
const int KeyPress::upKey           = extendedKeyModifier + 3;
const int KeyPress::downKey         = extendedKeyModifier + 4;
const int KeyPress::pageUpKey       = extendedKeyModifier + 5;
const int KeyPress::pageDownKey     = extendedKeyModifier + 6;
const int KeyPress::endKey          = extendedKeyModifier + 7;
const int KeyPress::homeKey         = extendedKeyModifier + 8;
const int KeyPress::deleteKey       = extendedKeyModifier + 9;
const int KeyPress::insertKey       = -1;
const int KeyPress::tabKey          = 61;
const int KeyPress::F1Key           = extendedKeyModifier + 10;
const int KeyPress::F2Key           = extendedKeyModifier + 11;
const int KeyPress::F3Key           = extendedKeyModifier + 12;
const int KeyPress::F4Key           = extendedKeyModifier + 13;
const int KeyPress::F5Key           = extendedKeyModifier + 14;
const int KeyPress::F6Key           = extendedKeyModifier + 16;
const int KeyPress::F7Key           = extendedKeyModifier + 17;
const int KeyPress::F8Key           = extendedKeyModifier + 18;
const int KeyPress::F9Key           = extendedKeyModifier + 19;
const int KeyPress::F10Key          = extendedKeyModifier + 20;
const int KeyPress::F11Key          = extendedKeyModifier + 21;
const int KeyPress::F12Key          = extendedKeyModifier + 22;
const int KeyPress::F13Key          = extendedKeyModifier + 23;
const int KeyPress::F14Key          = extendedKeyModifier + 24;
const int KeyPress::F15Key          = extendedKeyModifier + 25;
const int KeyPress::F16Key          = extendedKeyModifier + 26;
const int KeyPress::F17Key          = extendedKeyModifier + 50;
const int KeyPress::F18Key          = extendedKeyModifier + 51;
const int KeyPress::F19Key          = extendedKeyModifier + 52;
const int KeyPress::F20Key          = extendedKeyModifier + 53;
const int KeyPress::F21Key          = extendedKeyModifier + 54;
const int KeyPress::F22Key          = extendedKeyModifier + 55;
const int KeyPress::F23Key          = extendedKeyModifier + 56;
const int KeyPress::F24Key          = extendedKeyModifier + 57;
const int KeyPress::F25Key          = extendedKeyModifier + 58;
const int KeyPress::F26Key          = extendedKeyModifier + 59;
const int KeyPress::F27Key          = extendedKeyModifier + 60;
const int KeyPress::F28Key          = extendedKeyModifier + 61;
const int KeyPress::F29Key          = extendedKeyModifier + 62;
const int KeyPress::F30Key          = extendedKeyModifier + 63;
const int KeyPress::F31Key          = extendedKeyModifier + 64;
const int KeyPress::F32Key          = extendedKeyModifier + 65;
const int KeyPress::F33Key          = extendedKeyModifier + 66;
const int KeyPress::F34Key          = extendedKeyModifier + 67;
const int KeyPress::F35Key          = extendedKeyModifier + 68;
const int KeyPress::numberPad0      = extendedKeyModifier + 27;
const int KeyPress::numberPad1      = extendedKeyModifier + 28;
const int KeyPress::numberPad2      = extendedKeyModifier + 29;
const int KeyPress::numberPad3      = extendedKeyModifier + 30;
const int KeyPress::numberPad4      = extendedKeyModifier + 31;
const int KeyPress::numberPad5      = extendedKeyModifier + 32;
const int KeyPress::numberPad6      = extendedKeyModifier + 33;
const int KeyPress::numberPad7      = extendedKeyModifier + 34;
const int KeyPress::numberPad8      = extendedKeyModifier + 35;
const int KeyPress::numberPad9      = extendedKeyModifier + 36;
const int KeyPress::numberPadAdd            = extendedKeyModifier + 37;
const int KeyPress::numberPadSubtract       = extendedKeyModifier + 38;
const int KeyPress::numberPadMultiply       = extendedKeyModifier + 39;
const int KeyPress::numberPadDivide         = extendedKeyModifier + 40;
const int KeyPress::numberPadSeparator      = extendedKeyModifier + 41;
const int KeyPress::numberPadDecimalPoint   = extendedKeyModifier + 42;
const int KeyPress::numberPadEquals         = extendedKeyModifier + 43;
const int KeyPress::numberPadDelete         = extendedKeyModifier + 44;
const int KeyPress::playKey         = extendedKeyModifier + 45;
const int KeyPress::stopKey         = extendedKeyModifier + 46;
const int KeyPress::fastForwardKey  = extendedKeyModifier + 47;
const int KeyPress::rewindKey       = extendedKeyModifier + 48;

} // namespace juce
